\documentclass{kuisthesis}
%\documentclass[9pt,twocolumn]{jsarticle}
%\documentclass[12pt,titlepage]{jsarticle}

\usepackage{bm}
\usepackage{url}

\usepackage{amsmath}

\usepackage{listings}
\lstset{
	basicstyle={\ttfamily\scriptsize}, %書体の指定
	frame=none,      %フレームの指定
	framesep=10pt,   %フレームと中身（コード）の間隔
	breaklines=true, %行が長くなった場合の改行
	linewidth=12cm,  %フレームの横幅
	lineskip=0.0ex,  %行間の調整
	tabsize=2        %Tabを何文字幅にするかの指定
}

\def\LATEX{{\rm (L\kern-.36em\raise.3ex\hbox{\sc a})\TeX}}
\def\LATex{\iLATEX\small}
\def\iLATEX#1{L\kern-.36em\raise.3ex\hbox{#1\bf A}\kern-.15em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}
\def\LATEXe{\ifx\LaTeXe\undefined \LaTeX 2e\else\LaTeXe\fi}
\def\LATExe{\ifx\LaTeXe\undefined \iLATEX\scriptsize 2e\else\LaTeXe\fi}
\let\EM\bf
\def\|{\verb|}
\def\<{\(\langle\)}
\def\>{\(\rangle\)}
\def\CS#1{{\tt\string#1}}


\jtitle[一緒に移動するユーザーを不審者から守るロボットの研究]	% 和文題目（内容梗概／目次用）
       {一緒に移動するユーザーを不審者から守る\\ロボットの研究}	% 和文題目
\etitle{A Robot that Protects You from Malicious Person}	% 英文題目
\jauthor{内藤 謙史郎}				% 和文著者名
\eauthor{Kenshiro Naito}			% 英文著者名
\supervisor{神田 崇行 教授}			% 指導教員名
\date{平成31年2月8日}				% 提出年月日

\begin{document}
\maketitle

\begin{jabstract}				% 和文梗概
この手引では，特別研究報告書および修士論文をどのような構成とするか，またどの
ような形式で作成するかを説明したものである。また，当教室で定めた形式に則った
論文を日本語\LaTeX を用いて作成するためのスタイル・ファイル，
\verb|kuisthesis|の使い方についても説明している。なお，この手引自体も
\verb|kuisthesis|を用い，定められた形式に従って作成されているので，必要に応じ
てソース・ファイル\verb|guide.tex|を参照されたい。

なお、修士論文に関しては、この内容は旧情報工学専攻向けのものである。
情報学研究科の修士課程学生でこのマクロを利用する者は、各専攻の執筆規定に
従うこと。
\end{jabstract}

\begin{eabstract}				% 英文梗概
This guide gives instructions for writing your B.E. or M.E. theses following
the standard of the Department of Information Science.  The
standard includes the structure and format which you must obey on writing
your theses.

This guide also explains how to use a \LaTeX{} style file for theses, named
\verb|kuisthesis|, with which you can easily produce well-formatted results.
Since this guide itself is produced with the style file, it will help you to
refer its source file \verb|guide.tex| as an example.

Note for graduate students: This document is written for students of
old graduate school of information science, not for graudate school of
informatics. Writers of master thesis belonging to graduate school
of informatics must obey rules given by each department.
\end{eabstract}

\tableofcontents



%===============================================================================



\section{序論}

ロボットが人間の生活に役立つために、人間のやろうとしていることをいかに助け手伝うかということに関する研究はHuman Robot Interaction(HRI)の分野で大変盛んに行われている。一方でロボットは、人間のやろうとしていることを阻止したり思いとどまらせたちすることで貢献することもある。スーパーで万引きを防ぐ、禁じられた行動を取る人を注意するなどといった仕事をロボットに任せることができるようになれば

一人で帰る夜道……不審者に遭遇しないかと不安になることも多いだろう。そんなとき、一人で帰るよりも二人・複数人で一緒に帰る方が不審者に襲われにくいということは想像に難くない。しかし、いつも一緒に帰ってくれる人がいるとは限らない。その役割をロボットに任せることはできないだろうか。

現状でも、防犯ブザーや催涙スプレーのように不審者から身を守るためのグッズがあり、それらは広く利用されている。ただこれらは不審者に襲われてしまった後の対策として用いられている面が強い。それとはまた違った方向で、ロボットの存在が前もって犯罪を抑止できるような状況を実現し、ユーザーにより確かな安心感を提供するための一助になればと考える。

\section{関連研究}
関連のある他の研究をあげながら、本研究の立ち位置について考えたい。

まず、人とロボットが同じ空間内にあってそれぞれ行動するときに起こる現象ついての研究というものが数多く存在する。例えば、目的地まで障害物を避けながら人をナビゲートするロボットに関する研究がある\cite{1}。本研究はそのような研究の中の一つと考えることができるだろう。

さらに、空間を共有する人間に対してロボット良い印象を与えることを目的とした研究が存在する。例えば、展示を見て回る人間を極力邪魔しないようにしつつ案内を必要とする人間に近づくという動作に関する研究\cite{2}などがある。本研究は、これらとは逆に、不審者に対してプレッシャーを与え、犯罪行動を抑止するような動作を追求するものとなる。

そのような研究として近いものを探したところ、VIPの護衛を目的をして周囲の脅威を最小化する護衛ロボットの研究\cite{3}が存在した。目指しているものは本研究とほぼ同じものであるが、こちらの研究\cite{3}は周囲の人間の位置関係から「脅威度」を定義し、数値化されたそれを最小化するようなロボットの動作を模索するというアプローチであった。対して本研究では、同じような状況で人間が取る行動を観察し、有効なアルゴリズムをヒューリスティックに探すというアプローチを取ることにする。

/* TODO [2],[3]もっと具体的な内容まで書く？ */

\section{対象と問題の設定}
次の三者を対象とした問題を考える。

\begin{itemize}
	\item robot
	\item partner
	\item enemy
\end{itemize}

研究の対象となるロボットをrobot、守られるユーザーをpartner、不審者をenemyと表記する。

robotとpartnerは通常時、目的地まで連れ立って移動するが、enemy（不審者）を検知した際にrobotはpartnerを守る状態に移行する。enemy検知後の状態をprotect mode（護衛状態）、それ以前の状態をnormal mode（通常状態）と呼ぶ。

/* TODO 図：配置とモードの遷移(1P) */

enemyについては、partnerの所有物を奪おうとしている、危害を加えようとしているなど様々な想定が可能であるが、今回はそれらを総括してひとまずpartnerのいる地点まで近づくという動きをとるものとする。また、enemy検知において、近づいてくる人物が不審者であると判断するためには様々な要素が必要であるだろうが、今回はその判断の中身には触れず、単純に近づいて来るものはenemyであるという扱いをする。

以上の三者の中において、robotにどのような動きをとらせるのが最適かを考えていく。



%===============================================================================



\section{不審者からユーザーを守る振る舞いの観察}

ロボットにあるタスクを行わせたい時、実装するべき最適な動作を考えるにあたり、参考にできる情報としてまず、同じタスクを人間がどのように実行するのかということがあげられる。

\subsection{予備実験の設定}

一緒に歩いている人を不審者から守るというタスクを人間がどのように実行するかを観察するため、３名の協力者の方にそれぞれrobot, partner, enemyのロールプレイをお願いし、その様子を動画に撮影した。

並んで移動するpartnerとrobotに対し、正面からenemyが近づいて来るケースと後ろから追いかける形で近づいて来るケースを想定した。

/* TODO ビデオのキャプチャ画像(1P程度) */

\subsection{考察}
動画から人間ならば不審者からユーザを守ろうとした時どのような動きをとるかを観察し、アルゴリズムとして落とし込めそうな部分を探した。
その結果、以下のような動作が有効そうな振る舞いとしてあがった。

\begin{itemize}
\item robotは、partnerとenemyを割って入るような位置に移動する
\item robotは、partnerと一定の距離を保ちながら動く
\item robotは、常にenemyの方を向く
\end{itemize}

partnerとenemyのを結んだ直線上に割り込むような形で位置どり、partnerと一定の距離を取りながら移動することでenemyのpartnerへの動きを妨げるという狙いと、enemyの方を向き続けることでenemyに対してプレッシャーを与える狙いが見て取れた。



%===============================================================================



\section{アルゴリズム}

4節で導き出した動きをもとに、ロボットに取らせる動きを表現するためのアルゴリズムを考える。

\subsection{向かうべき位置の決定}

robot, partner, enemyの現在位置をそれぞれ $P_r$, $P_p$, $P_e$ とする。

robotが向かうべき地点を$T_r$とし、それぞれの状態で$T_r$がどのように定められるかを考える。

\subsubsection{通常状態}

まずはenemyのいない通常状態について考える。通常状態においてrobotはpartnerの横に並んで移動する。
これは、partnerの右隣、もしくは左隣のうち近い方を選択し、その位置どりを保持するということになる。

これを式にすると、

\begin{equation}
T_r = \frac{R(\theta)\bm{v}_p}{|\bm{v}_p|}d + P_p \nonumber
\end{equation}

となる。

ただし$\bm{v}_p$はpartnerの速度、$R(\theta)$は回転行列、$\theta$は

\begin{eqation}
\[
  \theta = \begin{cases}
     \frac{\pi}{2} \\
    -\frac{\pi}{2}
  \end{cases}
\] \nonumber
\end{eqation}

であり、$|T_r - P_r|$がより小さくなるような値が$\theta$の値として選ばれる。

また、$d$はrobotとpartnerとの間で保つべき距離である。
並んで移動すると一口に言っても、どの程度の距離をとって並ぶかでpartnerに与える印象は変わるだろう。近すぎると窮屈に感じるだろうし、遠すぎても並んで移動していると思えなくなってしまう。
この$d$の値を、護衛状態との比較を考えて次のように表すことにする。

\begin{equation}
d  = r_{normal} \nonumber
\end{equation}

%\vspace{1.0em}

\subsubsection{護衛状態}

続いて、enemyを検知した後の護衛状態におけるrobotの動きについて考える。

このときの$T_r$を式にすると、

\begin{equation}
T_r = \frac{(P_e - P_p)}{|P_e - P_p|}d + P_p \nonumber
\end{equation}

のようになる。

$d$は先ほどと同じく、robotとpartnerとの間で保つべき距離とする。
すなわち、$T_r$はpatnerのいる地点からenemyのいる地点への方向に$d$だけ離れた点を表している。

$d$については以下の式で表される。

\begin{equation}
d  = r_{protect} \frac{v_r_{max}}{max(|v_e_{\parallel} - v_p_{\parallel}|,v_r_{max})} \nonumber
\end{equation}

さらに、$r_{protect}$は$r_{social}$と対になる値で

$v_e_{\parallel}$の説明

/* TODO$ $v_e_{\parallel}$, $v_p_{\perp}$とかの説明用図 */




\subsection{速度の指定}

また、robotの向く方向$\psi_r_{des}$を、以下の式により表す。

\begin{equation}
	\psi_r_{des} = \frac{(P_p - P_r)}{|P_p - P_r|} \nonumber
\end{equation}

以上の条件において、robotに設定する速度$\bm{v}_R_{des}$は、以下の通りになる。
\begin{equation}
	\bm{v}_R_{des} = W_r (|v_e_{\perp} - v_p_{\perp}|+1)(T_r - P_r) \nonumber
\end{equation}

$v_e_{\parallel}$の説明

/* 図 (0.6p)*/



%===============================================================================



\section{システム}

\subsection{ロボット}

ロボットとしてRobovie R3 \footnote{\url{https://www.vstone.co.jp/products/robovie_r3/index.html}} を想定する。Robovie R3は人とロボットのコミュニケーション研究のための等身大ロボットであり、実際に人間が活動する環境での実証実験を想定し、点字ブロックやスロープなどの凹凸を乗り越えられる高い走破性や、高齢者と並んで移動するための移動速度（約2.5km/h）などを実現しているため、本研究での利用に適している。

図\ref{fig:robot}にロボットの外観を示す。

/* RobovieR3の画像(0.4p) */

\subsection{ソフトウェア}


\subsubsection*{ROS}
ロボットの制御にはロボット用のソフトウェアプラットフォームのROSを用いる。ROSはロボットの動作に関わるプロセスをpackageと呼ばれる形で抽象化し、多数のpackage間で交わされる通信をとりもつ。
package間で交わされる通信をROSではmessageと呼ぶ。packageはmessageを発信（publish）または受信（subscribe）している。

ロボットに新しい動作を実装したい場合、処理としては大きく以下の3つに分かれる。
\begin{itemize}
	\item センサー類から必要な情報を取得する（状況の把握）
	\item 取得した情報を処理し、ロボットにさせる動作の内容を決定する（判断）
	\item 駆動部分に動作の指示を出す（動作の実行）
\end{itemize}

１番目の処理を行うためにセンサー類を担当するpackageから読み取り情報をmessageとして受信し、３番目の処理を行うために動作の内容を記述したmessageを発信するという流れになっている。

\vspace{1.0em}

\subsubsection*{位置同定}
ロボットの動作を決定するためには、robot,partner,enemyそれぞれの位置を知る必要がある。

位置取得のためには、GPSやジャイロセンサ、地磁気センサなど様々な方法が存在するが、本研究では全方位レーダーを利用した位置同定を採用する。ロボットに取り付けたレーダー式距離センサで周辺の物体との距離を計測し、これと所与の地図情報により自身の位置の同定と人間のトラッキングを行う。

\vspace{1.0em}

\subsubsection*{速度の指定}
RobovieR3は"前後左右ななめのあらゆる方向へ移動が可能となる「全方位移動機構（オムニホイール）」"を搭載している。
この移動の方向・速さを指定するために/cmd\_vel というmessageを発信する。/cmd\_vel はX軸・Y軸方向への平行移動とZ軸周りの回転を数値で指定できるようになっており、これにより5節で述べたアルゴリズムで導出した速度を駆動部分へ伝える。

/* TODO センサやモジュールの図(0.4p) */

\subsection{実験用移動制御モジュール}

本研究で考案するロボットの移動を実験するために、移動制御モジュールをROSのpackageとして実装して組み込む。3節で述べたように、このモジュールは以下の通り、2つの状態とその間の遷移によって構成される。

\subsubsection*{通常状態}
robotはpartnerに並んで移動する。具体的な動作は5節にて述べた通りである。
\subsubsection*{不審者検知}
enemyがpartnerに害をなしうると判断される状況で、robotは通常状態から護衛状態に以降する。
\subsubsection*{護衛状態}
robotはenemyからpertnerを守るための動きを取る。

% \begin{lstlisting}
% \end{lstlisting}

/*クラス分けのくだり*/

/*人間の速度の取得のくだり*/

/*避けるくだり*/



%===============================================================================



\section{シミュレーションでの動作例}

先の過程で得られたアルゴリズム案を、シミュレーションの中で実行する。

\subsection{MORSE}

本研究ではシミュレータとして、morse simulator\footnote{\url{https://www.openrobots.org/morse/doc/stable/morse.html}}を使用する。MORSEは学術ロボット用の汎用シミュレータで、Blender\footnote{\url{https://www.blender.org/}}を内包しており3Dシミュレーション得意とする。

MORSEはPythonで書かれており、シミュレーションシナリオや設定もPythonスクリプトによって記述することができる。また、ROSとの親和性が高くシミュレーション上のセンサ情報や配置したオブジェクトの位置情報などをROSのmessageとして取得することができるので、ROSで実装したものをほぼそのまま動作させることが可能である。

フィールドにrobot, partner, enemyを配置し、partnerをキーボードで操作可能なように、enemyをpartnerに接近するよう設定する。それらに対してrobotがとるべき動きを、6.3節に記したようにモジュールとして実装しシミュレーション上で動作させる。


\subsection{実行結果}

4節における動画の観察からも分かったように、partnerとenemyの接近する方向などによってrobotの最適な挙動は変化しうる。今回はその一例として、以下の３パターンを想定してシミュレーションを実行する。

\begin{itemize}
	\item enemyが正面から接近する（すれ違うような形）
	\item enemyが後ろから接近する（追いかけてくるような形）
	\item enemyが斜め前方から接近する
\end{itemize}

これらの結果をキャプチャした画像を以下に掲載する。

/* TODO キャプチャ画像(3pくらい使ったれ！！ ｶﾞﾊﾊ！) */

% \subsection{実験室実験}
% シミュレーション上で実装したアルゴリズムをRobovie-R3の実機にインストールし、実験室内で動作させた(い)。
% （←ロボットについての説明とかだけ書いといて、実機を動かした動画は2/14の発表で見せる？）



%===============================================================================



\section{考察}

\subsection{提案手法について}
/* TODO  */ % 唯一主観的に書いていいところ

\subsection{今後の課題}

（ユーザの安心感・不審者側の警戒心といったものをシミュレーションでどう測る？）

/* TODO */

\section{結論}
/* TODO 全体のおさらい */

\section{謝辞}
本研究に取り組むにあたり、多大なるご指導を賜りました京都大学大学院情報学研究科の神田崇行教授、技術的な助言をいただきました同研究科のYuyi Liu特定研究員に深くお礼を申し上げます。また、日頃より様々なご協力をいただきました、神田研究室の皆様に感謝の意を申し上げます。

\begin{thebibliography}{3}
\bibitem{1} Masahiro Shiomi, Francesco Zanlungo, Kotaro Hayashi, Takayuki Kanda: Towards a Socially Acceptable Collision Avoidance for a Mobile Robot Navigating Among Pedestrians Using a Pedestrian Model, International Journal of Social Robotics(IJSR), Vol.6, Issue 3 ,pp.443-455, 2014.
\bibitem{2} Yusuke Kato, Takayuki Kanda, Hiroshi Ishiguro, May I help you? - Design of human-like polite approaching behavior -, ACM/IEEE international conference on Human-robot interaction (HRI 2015), pp. 35-42, 2015.
\bibitem{3} Taranjeet Singh Bhatia, Gürkan Solmaz, Damla Turgut, Ladislau Bölöni: Controlling the Movement of Robotic Bodyguards for Maximal Physical Protection, FLAIRS Conference(2016)
\end{thebibliography}
\end{document}
